# Minimum Changes on Bipartite Coloring

実行時間制限: 2 sec

## 問題文

$N$ 頂点 $M$ 辺の二部グラフ $G$ が与えられます。 $G$ は単純 (多重辺が存在しない) ですが、連結とは限りません。
$i (1 \le i \le M)$ 番目の辺は、 $u_i, v_i$ を双方向に結んでいます。

与えられた $G$ の各頂点を赤か青で塗ります。
以下の条件を満たすとき、その塗り方は「良い彩色」です。

- すべての辺 $e_i = \\{ u_i, v_i \\}$ に対して、頂点 $u_i, v_i$ が異なる色で塗られている
- 使われない色が存在しない

良い彩色 $\alpha, \beta$ が与えられます。
$\alpha(v), \beta(v)$ は頂点 $v$ の色を表しており、 0 なら赤に、 1 なら青に塗られていることを表しています。

Asa さんは、 $\alpha$ に対して以下の操作を繰り返すことで、 $\alpha$ を $\beta$ に一致させたいです。

- 1 頂点選び、その頂点の色を変える。 ただし、変更後の塗り方も良い彩色でなければならない。

最小で何度の操作をする必要があるかを求め、一致させることができるならばそれを実現する操作列を出力してください。
ただし、何回操作しても $\alpha$ を $\beta$ に一致させることができない場合は、 `-1` を出力してください。

## 制約

- $2 \le N \le 2 \times 10^5$
- $0 \le M \le \min\left( \dfrac{n^2}{4}, 2 \times 10^5 \right)$
- $1 \le u_i < v_i \le n$
- $\alpha(v), \beta(v) \in \\{ 0, 1 \\}$
- 与えられるグラフは単純な二部グラフである
- $\alpha, \beta$ はどちらも良い彩色である
- 入力はすべて整数である

### 部分点

この問題はいくつかの小課題に分けられ、その小課題の全てのテストケースに正解した場合に、「この小課題に正解した」とみなされます。
提出したソースコードの得点は、正解した小課題の点数の合計となります。

1. (10 点) $N \le 8$ 、かつ、出力した操作回数が正しい
2. (20 点) $N \le 8$ 、かつ、出力した操作回数と操作列が正しい
3. (25 点) 入力に関する追加制約はない、かつ、出力した操作回数が正しい
4. (45 点) 入力に関する追加制約はない、かつ、出力した操作回数と操作列が正しい

## 入力

$N$ $M$ <br>
$u_1$ $v_1$ <br>
... <br>
$u_M$ $v_M$ <br>
$\alpha(1)$ $\alpha(2)$ ... $\alpha(N)$ <br>
$\beta(1)$ $\beta(2)$ ... $\beta(N)$ <br>

## 出力

$\alpha, \beta$ を一致させることができる操作列が存在しない場合は `-1` を 1 行で出力せよ。
その他の余計な出力をしてはならない。余計な出力をした場合、小課題 1, 3 の得点も得られない。

存在する場合は、条件を満たす操作列のうち、操作回数が最小となるものを以下の形式で出力せよ。
ここで、 $t$ は操作回数を表し、 $v_i, c_i (1 \le i \le t)$ は「$i$ 回目の操作で頂点 $v_i$ の色を $c_i$ に変更する」という操作を表す。

```text
t
v_1 c_1
v_2 c_2
...
v_t c_t
```

答えが複数存在する場合、どれを出力しても正解とみなされる。
ただし、出力は以下の条件を満たす必要がある。

- $1 \le v_i \le n$
- $0 \le c_i \le 1$
- $t, v_i, c_i$ はすべて整数

特に、 $t = 0$ の場合は、 `0` を 1 行で出力し、その他の余計な出力をしてはならない。
余計な出力をした場合、小課題 1, 3 の得点も得られない。

## サンプル

### 1

```text
3 1
1 2
0 1 0
0 1 1
```

```text
1
3 1
```

あり得る頂点の塗り方は、以下の 8 種類です。
このうち、頂点 1, 2 が異なる色で塗られている (3), (4), (5), (6) の塗り方は「良い彩色」です。
なお、 $\alpha, \beta$ はそれぞれ (3), (4) に対応します。

![Sample 1](https://a01sa01to.com/images/cms/2024/08/maximum-cup-2024-img/coloring/sample1.svg)

以下の操作を行うことで、 1 回で $\alpha$ を $\beta$ に一致させることができます。

1. 頂点 3 の色を、赤から青に変更する。

### 2

```text
5 6
1 2
1 4
2 3
3 4
2 5
4 5
0 1 0 1 0
0 1 0 1 0
```

```text
0
```

与えられる良い彩色は同一であることもあります。
なお、このグラフ・彩色を図示すると、以下のようになります。

![Sample 2](https://a01sa01to.com/images/cms/2024/08/maximum-cup-2024-img/coloring/sample2.svg)

### 3

```text
4 4
1 2
1 4
2 3
3 4
0 1 0 1
1 0 1 0
```

```text
-1
```

与えられたグラフに対する良い彩色は以下の 2 つのみですが、どのように操作しても一致させることはできません。

![Sample 3](https://a01sa01to.com/images/cms/2024/08/maximum-cup-2024-img/coloring/sample3.svg)

## 解法

Memo: Rime だと得点が正しく計算できないので、 MOFE を使う

### 部分点解法

(partial1: 操作回数のみ)
(partial2: 復元付き)

問題を言い換えると、以下のようになる

- 良い彩色に ID を振って、頂点番号とする
- 1 頂点の変更で一致させられるような良い彩色間に辺を張る
- $\alpha, \beta$ に対応する頂点間の最短経路を求めよ

このようなグラフを作成し、最短経路を求めることで解くことができる。

### 満点解法

(partial3: 操作回数のみ)

1 頂点を変更しようとすると隣接点も変更する必要があるので、 2 頂点以上からなる連結成分に属する頂点の色が変わっていれば `-1`。
これは次数を数えておいて次数 1 以上の頂点が変更されたら `-1` とかをやれば OK。

そうではないとき、 $c_{a,b}$ を $\alpha(v) = a, \beta(v) = b$ となる頂点 $v$ の個数とする。
このとき、 $\alpha, \beta$ が良い彩色であることに注意すると、 $c_{0,0} + c_{1,1} = 0, c_{0,1} = c_{1,0} = 1$ のケースで `-1` 、そうではないときには $c_{0,1} + c_{1,0}$ 回の操作で一致させることができる。 (簡単な説明はスライド参照)
構築は、使わない色が存在しないように注意しながら操作を行うようにすればよい。
