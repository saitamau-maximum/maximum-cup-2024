# Maximum vs Merin

実行時間制限：2 sec

## 問題文

埼玉大学には $N$ 種類のスライムが生息しており、 $i$ 種類目のスライムは体力が $H_i$ で $C_i$ 体存在します。

Maximum 君と Merin ちゃんは経験値を獲得するべく、一緒にスライムを倒すことにしました。\
二人は以下の行動のうち 1 つを選んで行うことを交互に繰り返します。先手は Maximum 君です。

- スライムを 1 体選んで攻撃することで、スライムの体力を $d$ 減らす。ただし、二人が 1 回の攻撃で減らすことができる体力は最大で $D$ であり、 $d$ は $1 \leq d \leq D$ を満たす任意の整数である。
- スライムを 1 体選んで 2 体のスライムに分裂させる。ただし、分裂後のスライムの体力はともに正の整数であり、それらの和は元のスライムの体力に等しいものとする。

体力が 0 以下になったスライムは、その時点で倒されて消滅します。

最後の一体のスライムを倒した者だけが経験値を獲得できます。

両者が最適に行動した場合、経験値を取得できるのが Maximum 君であれば `Maximum`、Merin ちゃんであれば `Merin` と出力してください。

## 制約

- $1 \leq N \leq 2 \times 10^5$
- $1 \leq D \leq 10^9$
- $1 \leq H_i, \ C_i \leq 10^9$
- 入力は全て整数である。

## 部分点

この問題はいくつかの小課題に分けられ、その小課題の全てのテストケースに正解した場合に、「この小課題に正解した」とみなされます。
提出したソースコードの得点は、正解した小課題の点数の合計となります。

1. （20 点） $\sum_{i=1}^{N} H_i C_i \leq 30$ を満たす。
2. （30 点） $1 \leq H_i \leq 3000$ を満たす。
3. （50 点） 追加の制約はない。

## 入力

$N \ D$ \
$H_1 \ C_1$ \
$H_2 \ C_2$ \
$:$ \
$H_N \ C_N$

## 出力

Maximum 君が経験値を取得できるならば `Maximum`、Merin ちゃんが経験値を取得できるならば `Merin` を出力せよ。

### 入力例 1

```txt
2 2
1 2
3 1
```

### 出力例 1

```txt
Merin
```

この入力では、Maximum 君がどのような行動をしても Merin ちゃんが経験値を貰うことが可能です。\
以下は行動の一例です。

1. Maximum 君が体力 3 のスライムの体力を 1 減らす。体力 1 のスライムが 2 体, 体力 2 のスライムが 1 体になる。
2. Merin ちゃんが体力 2 のスライムを体力 1 のスライム 2 体に分裂させる。体力 1 のスライムが 4 体になる。
3. Maximum 君が体力 1 のスライムの体力を 1 減らす。攻撃されたスライムは倒され、体力 1 のスライムが 3 体になる。
4. Merin ちゃんが体力 1 のスライムの体力を 1 減らす。攻撃されたスライムは倒され、体力 1 のスライムが 2 体になる。
5. Maximum 君が体力 1 のスライムの体力を 1 減らす。攻撃されたスライムは倒され、体力 1 のスライムが 1 体になる。
6. Merin ちゃんが体力 1 のスライムの体力を 1 減らす。攻撃されたスライムは倒され、全てのスライムが倒される。

よって、最後の一体を倒して経験値を貰えるのは Merin ちゃんです。

なお、この入力例は小課題 1, 2, 3 の制約を満たします。

### 入力例 2

```txt
3 100
12 23
30 12
98 5
```

### 出力例 2

```txt
Maximum
```

この入力例は小課題 2, 3 の制約を満たします。

### 入力例 3

```txt
5 4649
3728 9183
48932 2438927
43 84239882
4433483 4349
9859 963096
```

### 出力例 3

```txt
Merin
```

この入力例は小課題 3 の制約を満たします。

## 解法

- `sol-cpp-partial1` : C++ 部分点 1
- `sol-py-partial1` : Python 部分点 1
- `sol-cpp-partial2` : C++ 部分点 2
- `sol-py-partial2` : Python 部分点 2
- `sol-cpp-ac` : C++ AC
- `sol-py-ac` : Python AC

### 部分点 1 解法

$\sum_{i=1}^{N} H_i C_i \leq 30$ という制約により、本問題の操作で存在し得る状態は高々 30 以下の正の整数の分割数の総和になります。\
正の整数 $N$ の分割数を $d(N)$ とすると、 $\sum_{i=1}^{30}d(i) = 28628$ です。([OEIS 参照](https://oeis.org/A000041))

本問題の操作は、一つの状態当たりの遷移は多く見積もっても $\max(H)^2$ ほどです。
生存しているスライムの配列をメモ化しながら後退解析を行うことで、部分点 1 は $U = \sum_{i=1}^{N} H_i C_i, V = \sum_{i=1}^{U} d(i)$ と置くと $O(V \log V \max(H)^2)$ で解くことが可能です。\
これは、雑に書いても定数倍が小さいため、十分高速に解くことが可能です。

### 部分点 2 解法

$g(N)$ をスライム 1 体の体力が $N$ の時の Grundy 数とすると、

$$g(N) = \text{mex}( \lbrace g(N - d), g(N - k) \oplus g(k) | 1 \leq d \leq D \rbrace)$$

になります。よって、 $N$ までの Grundy 数を求めて、奇数匹存在するスライムの Grundy 数の排他的論理和がゼロか否かを確認することで、部分点 2 は $O(N + \max(H)^2)$ で解くことが可能です。

### AC 解法

部分点 2 で述べた Grundy 数を実際に眺めてみると、規則性があることに気が付きます。
具体的には以下の様な規則性があります。（ここでは証明略）

- 最初の 0 を除いた $d + d \ \% \ 2$ 項は、4 項ごとに以下の周期になっている

$$\lbrace 4k-3, \ 4k-2, \ 4k, \ 4k-1 \rbrace$$

- 上記よりも後ろの項は、それぞれ以下の周期になっている

$$
\begin{equation}
  \begin{cases}
    \lbrace 0, \ D+1 \rbrace + \lbrace 4k-2, \ 4k-3, \ 4k-1, \ 4k \rbrace^* & \text{if D $\equiv$ 1 (mod \ 2)} \nonumber \\
    \lbrace 0 \rbrace + \lbrace 4k-3, \ 4k-2, \ 4k, \ 4k-1 \rbrace^* & \text{if D $\equiv$ 0 (mod \ 2)} \nonumber \\
  \end{cases}
\end{equation}
$$

※ $^*$ は該当の数列をそれぞれ $D$ 項分だけ周期的に繰り返すことを示す。

この規則性により、 $g(N)$ は $O(1)$ で求めることができます。\
よって、部分点 3 は $O(N)$ で解くことが可能です。
